from elasticsearch import Elasticsearch

# Подключение к БД
ELASTIC_HOST = "http://localhost:9200"
ELASTIC_USER = "elastic"
ELASTIC_PASSWORD = "your_password"

es = Elasticsearch(ELASTIC_HOST, basic_auth=(ELASTIC_USER, ELASTIC_PASSWORD))

# Настройки
output_file = "logs.txt"
index_name = "your_index_name"

# Проверяем, существует ли индекс
if not es.indices.exists(index=index_name):
    print(f"⚠️ Индекс '{index_name}' не найден. Создаю...")
    es.indices.create(index=index_name)
    print(f"✅ Индекс '{index_name}' создан.")

# Получаем данные из Elasticsearch
response = es.search(body={
    "_source": ["host.name", "winlogon.event_data.SubjectUserName"],
    "query": {
        "term": {"winlogon.event_data.SubjectUserName": "sa"}
    },
    "from": 0,  # Добавлена запятая
    "size": 50
}, index=index_name)  # Указание индекса

# Вывод результата в консоль
print("Ответ от Elasticsearch:")
for hit in response["hits"]["hits"]:
    print(hit["_source"])  # Выводит содержимое документов
